# Pilotage des capteurs MEMS :: Tutoriel sur RIOT et LoRa/LoRaWAN avec la carte Wyres Base

[Précédent](04.md) | [Top](README.md) |  [Suivant](06.md)

Dans ce chapitre, vous apprendrez à recolter les mesures
* de capteurs numériques (MEMS) de la carte Wyres Base
* ainsi que celles de capteurs connectés via le connecteur Grove I2C de la carte.


## Rappel

> Configurez la carte cible pour `make`
```bash
export BOARD=wyres-base
export EXTERNAL_BOARD_DIRS=~/github/campusiot/RIOT-wyres/boards
```

## Capteur pression atmosphérique ST LPS22HB

La carte comporte un capteur ST LPS22HB de température et de pression atmosphérique. Le pilote générique de cette gamme de capteurs `LPSxxx` est founi par RIOT OS.

```bash
cd ~/github/RIOT-OS/RIOT/tests/drivers/lpsxxx/
DRIVER=lps22hb make -j 16 flash
```

<details>
<summary>Console</summary>
<pre>
main(): This is RIOT! (Version: 2023.07-devel-325-g2863d)
Test application for lps22hb pressure sensor

Initializing lps22hb sensor
Pressure value: 995hPa - Temperature: 21.21°C
Pressure value: 995hPa - Temperature: 21.20°C
Pressure value: 995hPa - Temperature: 21.20°C
Pressure value: 995hPa - Temperature: 21.20°C
Pressure value: 995hPa - Temperature: 21.20°C
</pre>
</details>

> Exercice: quelles peuvent-être les applications (ie usages) de ce capteur ?
<details>
<summary>Réponse(s)</summary>
<ul>
<li>TODO</li>
</ul>
</details>


### Capteurs I2C externes

La carte peut être étendue en raccordant un ou plusieurs capteurs I2C via le connecteur Grove I2C de la carte.

Repérez le modèle de capteur que vous avez en votre possession et branchez le au connecteur Grove I2C de la carte

### BME280

```bash
cd ~/github/RIOT-OS/RIOT/tests/drivers/bmx280/
make -j 16 flash
```

<details>
<summary>Console</summary>
<pre>
TODO
</pre>
</details>

> Exercice: quelles peuvent-être les applications (ie usages) de ce capteur ?
<details>
<summary>Réponse(s)</summary>
<ul>
<li>TODO</li>
</ul>
</details>

## BMP180 & GY-68

```bash
cd ~/github/RIOT-OS/RIOT/tests/drivers/bmp180/
make -j 16 flash
```

<details>
<summary>Console</summary>
<pre>
TODO
</pre>
</details>

> Exercice: quelles peuvent-être les applications (ie usages) de ce capteur ?
<details>
<summary>Réponse(s)</summary>
<ul>
<li>TODO</li>
</ul>
</details>

## mpl3115a2

```bash
cd ~/github/RIOT-OS/RIOT/tests/drivers/mpl3115a2/
make -j 16 flash
```

<details>
<summary>Console</summary>
<pre>
TODO
</pre>
</details>

> Exercice: quelles peuvent-être les applications (ie usages) de ce capteur ?
<details>
<summary>Réponse(s)</summary>
<ul>
<li>TODO</li>
</ul>
</details>

## MAG3110

```bash
cd ~/github/RIOT-OS/RIOT/tests/drivers/mag3110/
make -j 16 flash
```

<details>
<summary>Console</summary>
<pre>
TODO
</pre>
</details>

> Exercice: quelles peuvent-être les applications (ie usages) de ce capteur ?
<details>
<summary>Réponse(s)</summary>
<ul>
<li>TODO</li>
</ul>
</details>


## SAUL

[SAUL ([S]ensor [A]ctuator [U]ber [L]ayer)](https://doc.riot-os.org/group__drivers__saul.html) est une interface d'abstraction des capteurs pour les applications. Les pilotes de capteurs compatibles SAUL sont listés dans un registre. La collecte des mesures ne dépend plus d'une interface spécifique à un modèle de capteurs.

```bash
cd ~/github/campusiot/RIOT-wyres/tests/saul
make -j 16 flash
```

<details>
<summary>Console</summary>
<pre>
main(): This is RIOT! (Version: 2023.07-devel-325-g2863d)
SAUL test application

Dev: lps22hb    Type: SENSE_PRESS
Data:            	995 hPa

Dev: lps22hb    Type: SENSE_TEMP
Data:          	20.97 °C

##########################

Dev: lps22hb    Type: SENSE_PRESS
Data:            	995 hPa

Dev: lps22hb    Type: SENSE_TEMP
Data:          	20.97 °C
</pre>
</details>

## Exploration des capteurs I2C

Ce [programme](https://github.com/RIOT-OS/RIOT/tree/master/tests/periph/i2c#readme) vous permet de tester toutes les fonctions I2C de bas niveau disponibles à l'aide du Shell sur les capteurs I2C présents sur la carte. Il offre la possibilité de débbuger les pilotes I2C de nouveaux capteurs via le Shell

```bash
cd ~/github/campusiot/RIOT-wyres/tests/periph/i2c
make -j 16 flash
```

## Contributions à RIOT

RIOT OS ne supporte pas tous les capteurs de la carte et les capteurs externes dont vous disposez.

Vous pouvez entreprendre l'écriture du pilote et du test idoine et le contribuer à RIOT via une pull-request.

Voici quelques capteurs pour les pilotes sont à écrire.

### Accéléromètre lis2de12 (builtin)
http://www.emcu.eu/wp-content/uploads/2016/11/ST-SensorsOverviewMM201705.pdf#page=5 

```bash
cd ~/github/RIOT-OS/RIOT/tests/drivers/lis2dh12/
BOARD=wyres-base EXTERNAL_BOARD_DIRS=~/github/campusiot/RIOT-wyres/boards DRIVER=lis2dh12_i2c make -j 16

main(): This is RIOT! (Version: 2023.07-devel-325-g2863d)
using SPI mode, for I2C mode select the lis2dh12_i2c module
lis2dh12 [Failed]
8001603
main(): This is RIOT! (Version: 2023.07-devel-325-g2863d)
using I2C mode, for SPI mode select the lis2dh12_spi module
lis2dh12 [Initialized]
800161f
</pre>
</details>

### MMA7361

```bash
cd ~/github/RIOT-OS/RIOT/tests/drivers/mma7660/
BOARD=wyres-base EXTERNAL_BOARD_DIRS=~/github/campusiot/RIOT-wyres/boards make -j 16
```

### GY-521 MPU-6050 Gyroscope 3 axes et accéléromètre
a noter, il existe ce pilote pour un capteur MEMS d'une gamme silmilaire  mpu9x50 

### MPL115A2
https://www.nxp.com/docs/en/data-sheet/MPL115A2.pdf 


### BMP085 Digital Pressure Sensor Module (GY-65)



## Idée de projet : mesurer le niveau d'eau d'une rivière ou d'un lac au moyen du capteur `lis2de12`

https://hackaday.io/project/186862-water-level-lora-sensor

![Brian's Water Level LoRaWAN Sensor](images/water_level_lorawan_sensor.jpg)
